- name: "{{ lookup('pipe', 'date +%H:%M:%S') }} | localhost | Group: {{ group_item.name }} | Processing Group"
  debug:
    msg: "Starting deployment for group '{{ group_item.name }}' with {{ group_item.apps | length }} apps."

# Phase 1: Trigger/Start all apps in this group
- name: "{{ lookup('pipe', 'date +%H:%M:%S') }} | localhost | Group: {{ group_item.name }} | Trigger Start Sequence"
  include_tasks: _deploy_start.yml
  loop: "{{ group_item.apps }}"
  loop_control:
    loop_var: item_plan
  when: >
    only_apps is not defined or 
    (only_apps.split(',') | map('trim') | list) | intersect([item_plan.app_name]) | length > 0

# Phase 2: Verify all apps in this group
- name: "{{ lookup('pipe', 'date +%H:%M:%S') }} | localhost | Group: {{ group_item.name }} | Trigger Health Checks"
  include_tasks: _deploy_verify.yml
  loop: "{{ group_item.apps }}"
  loop_control:
    loop_var: item_plan
  when: >
    only_apps is not defined or 
    (only_apps.split(',') | map('trim') | list) | intersect([item_plan.app_name]) | length > 0
