app_definitions:
  # 1. 模拟数据库 (依赖基础)
  db_mysql_demo:
    image: alpine:latest
    raw_command: |
      docker run -d \
      --name db_mysql_demo \
      --health-cmd="test -f /tmp/db_ready || exit 1" \
      --health-interval=2s \
      --health-retries=10 \
      alpine:latest \
      sh -c "rm -f /tmp/db_ready; echo 'Init DB...'; sleep 5; echo 'DB Ready' > /tmp/db_ready; tail -f /dev/null"

  # 2. 模拟应用 (依赖 DB)
  app_backend_1:
    image: nginx:alpine
    ports:
      - "8082:80"
    raw_command: |
      docker run -d --name app_backend_1 -p 8082:80 \
      --health-cmd="wget -q --spider http://localhost:80 || exit 1" \
      --health-interval=2s --health-retries=3 \
      nginx:alpine

  app_backend_2:
    image: nginx:alpine
    ports:
      - "8083:80"
    raw_command: |
      docker run -d --name app_backend_2 -p 8083:80 \
      --health-cmd="wget -q --spider http://localhost:80 || exit 1" \
      --health-interval=2s --health-retries=3 \
      nginx:alpine

  # 3. 模拟本地命令执行 (SRE 场景)
  cmd_verify_api:
    app_type: cmd
    command: "curl -s -o /dev/null -w \"%{http_code}\" http://localhost:8082"
    healthcheck:
      type: exit_code